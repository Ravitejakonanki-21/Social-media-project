{% extends "base.html" %}
{% block title %}{{ profile_user.username }} — Profile{% endblock %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card mb-4 overflow-hidden">
      {% if profile.cover_photo %}
        <img src="{{ profile.cover_photo.url }}" alt="Cover" class="card-img-top" style="height: 200px; object-fit: cover;">
      {% else %}
        <div class="bg-secondary" style="height: 200px;"></div>
      {% endif %}
      <div class="card-body position-relative" style="margin-top: -60px;">
        <div class="d-flex align-items-end gap-3 flex-wrap">
          {% if profile.profile_picture %}
            <img src="{{ profile.profile_picture.url }}" alt="{{ profile_user.username }}" class="rounded-circle border border-4 border-white shadow" width="120" height="120" style="object-fit: cover;">
          {% else %}
            <span class="rounded-circle border border-4 border-white bg-secondary d-inline-flex align-items-center justify-content-center text-white fw-bold display-6" style="width:120px;height:120px;">{{ profile_user.username|slice:":1"|upper }}</span>
          {% endif %}
          <div class="flex-grow-1">
            <h1 class="h3 mb-1">{{ profile_user.username }}</h1>
            {% if profile.location %}<p class="text-muted small mb-0"><i class="bi bi-geo-alt"></i> {{ profile.location }}</p>{% endif %}
            {% if profile.bio %}<p class="mt-2 mb-0">{{ profile.bio }}</p>{% endif %}
            {% if user.is_authenticated and user != profile_user %}
              <div class="mt-2">
                <a href="{% url 'friends:send' profile_user.username %}" class="btn btn-accent btn-sm">Add friend</a>
                <a href="{% url 'friends:follow' profile_user.username %}" class="btn btn-outline-secondary btn-sm">Follow</a>
              </div>
            {% elif user == profile_user %}
              <a href="{% url 'users:profile_edit' %}" class="btn btn-outline-primary btn-sm mt-2">Edit profile</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <h5 class="mb-3">Posts</h5>
    {% for post in posts %}
    <article class="card mb-3">
      <div class="card-body">
        <p class="mb-2">{{ post.content }}</p>
        {% if post.image %}<img src="{{ post.image.url }}" alt="" class="img-fluid rounded mb-2" style="max-height: 300px; object-fit: contain;">{% endif %}
        <span class="text-muted small">{{ post.created_at|timesince }} ago · {{ post.get_visibility_display }} · <i class="bi bi-heart"></i> {{ post.total_likes }} · <i class="bi bi-chat"></i> {{ post.comments.count }}</span>
      </div>
    </article>
    {% empty %}
    <p class="text-muted">No posts yet.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
